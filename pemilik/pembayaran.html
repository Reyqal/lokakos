<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lokakos - Pembayaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.2/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      .sidebar {
        transition: all 0.3s;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <div
        class="sidebar bg-blue-800 text-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out"
        id="sidebar"
      >
        <div class="flex items-center space-x-2 px-4">
          <i data-feather="home" class="w-8 h-8"></i>
          <span class="text-2xl font-extrabold">LOKAKOS</span>
        </div>
        <nav>
          <a
            href="dashboard_pemilik.html"
            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700"
          >
            <i data-feather="grid" class="w-5 h-5 mr-2"></i> Dashboard
          </a>
          <a
            href="kelola-kos.html"
            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700"
          >
            <i data-feather="home" class="w-5 h-5 mr-2"></i> Kelola Kos
          </a>
          <a
            href="booking.html"
            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700"
          >
            <i data-feather="calendar" class="w-5 h-5 mr-2"></i> Booking
          </a>
          <a
            href="pembayaran.html"
            class="block py-2.5 px-4 rounded transition duration-200 bg-blue-700 text-white"
          >
            <i data-feather="dollar-sign" class="w-5 h-5 mr-2"></i> Laporan
            Pembayaran
          </a>
          <a
            href="profil.html"
            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700"
          >
            <i data-feather="user" class="w-5 h-5 mr-2"></i> Profil
          </a>
          <a
            href="../logout.php"
            class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700"
          >
            <i data-feather="log-out" class="w-5 h-5 mr-2"></i> Keluar
          </a>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm z-10">
          <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center">
              <button
                id="menuBtn"
                class="text-gray-500 focus:outline-none md:hidden"
              >
                <i data-feather="menu" class="w-6 h-6"></i>
              </button>
              <h1 class="text-xl font-semibold text-gray-800 ml-2">
                Pembayaran
              </h1>
            </div>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <i data-feather="bell" class="w-6 h-6 text-gray-500"></i>
                <span
                  class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500"
                ></span>
              </div>
              <div class="relative">
                <img
                  src="../img/profil.png"
                  alt="User"
                  class="w-8 h-8 rounded-full"
                />
              </div>
            </div>
          </div>
        </header>

        <!-- Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4">
          <!-- Filter Section -->
          <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div
              class="flex flex-col md:flex-row md:items-center md:justify-between"
            >
              <h2 class="text-lg font-semibold text-gray-800 mb-4 md:mb-0">
                Daftar Pembayaran
              </h2>
              <div class="flex space-x-2">
                <select
                  id="filterStatus"
                  class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                >
                  <option value="semua">Semua Status</option>
                  <option value="menunggu">Menunggu Konfirmasi</option>
                  <option value="dikonfirmasi">Dikonfirmasi</option>
                  <option value="ditolak">Ditolak</option>
                </select>
                <input
                  type="text"
                  id="searchPembayaran"
                  placeholder="Cari pembayaran..."
                  class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                />
              </div>
            </div>
          </div>

          <!-- Pembayaran List -->
          <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ID Pembayaran
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Nama Penyewa
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Kos
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Periode
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Jumlah
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Metode
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Aksi
                    </th>
                  </tr>
                </thead>
                <tbody
                  class="bg-white divide-y divide-gray-200"
                  id="pembayaranList"
                >
                  <!-- Data pembayaran akan dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal Detail Pembayaran -->
    <div
      id="detailPembayaranModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden"
    >
      <div
        class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Detail Pembayaran</h3>
          <button
            onclick="hideDetailPembayaranModal()"
            class="text-gray-500 hover:text-gray-700"
          >
            <i data-feather="x" class="w-6 h-6"></i>
          </button>
        </div>

        <div class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-sm font-medium text-gray-500">ID Pembayaran</h4>
              <p id="detailPembayaranId" class="mt-1 text-sm text-gray-900">
                PY-20230001
              </p>
            </div>
            <div>
              <h4 class="text-sm font-medium text-gray-500">
                Tanggal Pembayaran
              </h4>
              <p
                id="detailPembayaranTanggal"
                class="mt-1 text-sm text-gray-900"
              >
                15 Juni 2023
              </p>
            </div>
          </div>

          <div>
            <h4 class="text-sm font-medium text-gray-500">Nama Penyewa</h4>
            <p id="detailPembayaranNama" class="mt-1 text-sm text-gray-900">
              Andi Wijaya
            </p>
          </div>

          <div>
            <h4 class="text-sm font-medium text-gray-500">Kos</h4>
            <p id="detailPembayaranKos" class="mt-1 text-sm text-gray-900">
              Kos Mawar Indah (Putri)
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-sm font-medium text-gray-500">Periode Sewa</h4>
              <p
                id="detailPembayaranPeriode"
                class="mt-1 text-sm text-gray-900"
              >
                Juli 2023 - Desember 2023
              </p>
            </div>
            <div>
              <h4 class="text-sm font-medium text-gray-500">Jumlah</h4>
              <p id="detailPembayaranJumlah" class="mt-1 text-sm text-gray-900">
                Rp 9.000.000
              </p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h4 class="text-sm font-medium text-gray-500">
                Metode Pembayaran
              </h4>
              <p id="detailPembayaranMetode" class="mt-1 text-sm text-gray-900">
                Transfer Bank (BCA)
              </p>
            </div>
            <div>
              <h4 class="text-sm font-medium text-gray-500">Status</h4>
              <p id="detailPembayaranStatus" class="mt-1 text-sm font-medium">
                <span
                  id="pembayaranStatusBadge"
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  >Dikonfirmasi</span
                >
              </p>
            </div>
            <div>
              <h4 class="text-sm font-medium text-gray-500">Status</h4>
              <p id="detailPembayaranStatus" class="mt-1 text-sm font-medium">
                <span
                  id="pembayaranStatusBadge"
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  >Menunggu Konfirmasi</span
                >
              </p>
            </div>
          </div>

          <div>
            <h4 class="text-sm font-medium text-gray-500">Bukti Pembayaran</h4>
            <img
              id="detailPembayaranBukti"
              src=""
              alt="Bukti Pembayaran"
              class="mt-2 max-w-full h-auto rounded-md border border-gray-200"
            />
          </div>

          <div
            id="pembayaranActionButtons"
            class="flex justify-end space-x-3 pt-4"
          >
            <!-- Buttons will be added dynamically based on status -->
          </div>
        </div>
      </div>
    </div>

    <script>
      feather.replace();

      // Toggle sidebar on mobile
      const sidebar = document.getElementById("sidebar");
      const menuBtn = document.getElementById("menuBtn");

      menuBtn.addEventListener("click", () => {
        sidebar.classList.toggle("-translate-x-full");
      });

      // Sample data for payments
      let pembayaranData = [
        {
          id: "PY-20230001",
          nama: "Siti Syakirah",
          kos: "Kos Mawar Indah",
          tipe: "Putri",
          tanggal: "27 Mei 2023",
          periode: "Juli 2023 - Desember 2023",
          jumlah: 9000000,
          metode: "Transfer Bank (BCA)",
          bukti: "../img/bukti.jpeg",
          foto: "../img/profil.png",
        },
      ];

      // Load pembayaran data to table
      function loadPembayaranData(filter = "semua", search = "") {
        const pembayaranList = document.getElementById("pembayaranList");
        pembayaranList.innerHTML = "";

        const filteredData = pembayaranData.filter((pembayaran) => {
          const matchesFilter =
            filter === "semua" || pembayaran.status === filter;
          const matchesSearch =
            search === "" ||
            pembayaran.id.toLowerCase().includes(search.toLowerCase()) ||
            pembayaran.nama.toLowerCase().includes(search.toLowerCase()) ||
            pembayaran.kos.toLowerCase().includes(search.toLowerCase());
          return matchesFilter && matchesSearch;
        });

        filteredData.forEach((pembayaran) => {
          const statusClass =
            pembayaran.status === "menunggu"
              ? "bg-yellow-100 text-yellow-800"
              : pembayaran.status === "dikonfirmasi"
              ? "bg-green-100 text-green-800"
              : "bg-red-100 text-red-800";
          const statusText =
            pembayaran.status === "menunggu"
              ? "Menunggu"
              : pembayaran.status === "dikonfirmasi"
              ? "Dikonfirmasi"
              : "Ditolak";

          const row = document.createElement("tr");
          row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${pembayaran.id}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <img class="h-10 w-10 rounded-full" src="${
                                  pembayaran.foto
                                }" alt="${pembayaran.nama}">
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${
                                  pembayaran.nama
                                }</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${
                          pembayaran.kos
                        }</div>
                        <div class="text-sm text-gray-500">${
                          pembayaran.tipe
                        }</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${pembayaran.periode}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        Rp ${pembayaran.jumlah.toLocaleString("id-ID")}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${pembayaran.metode}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showDetailPembayaran('${
                          pembayaran.id
                        }')" class="text-blue-600 hover:text-blue-900">Detail</button>
                    </td>
                `;
          pembayaranList.appendChild(row);
        });
      }

      // Show pembayaran detail
      function showDetailPembayaran(id) {
        const modal = document.getElementById("detailPembayaranModal");
        const pembayaran = pembayaranData.find((p) => p.id === id);
        if (!pembayaran) return;

        // Set status badge class
        let statusClass, statusText;
        switch (pembayaran.status) {
          case "menunggu":
            statusClass = "bg-yellow-100 text-yellow-800";
            statusText = "Menunggu Konfirmasi";
            break;
          case "dikonfirmasi":
            statusClass = "bg-green-100 text-green-800";
            statusText = "Dikonfirmasi";
            break;
          case "ditolak":
            statusClass = "bg-red-100 text-red-800";
            statusText = "Ditolak";
            break;
        }

        // Update modal content
        document.getElementById("detailPembayaranId").textContent =
          pembayaran.id;
        document.getElementById("detailPembayaranTanggal").textContent =
          pembayaran.tanggal;
        document.getElementById("detailPembayaranNama").textContent =
          pembayaran.nama;
        document.getElementById(
          "detailPembayaranKos"
        ).textContent = `${pembayaran.kos} (${pembayaran.tipe})`;
        document.getElementById("detailPembayaranPeriode").textContent =
          pembayaran.periode;
        document.getElementById(
          "detailPembayaranJumlah"
        ).textContent = `Rp ${pembayaran.jumlah.toLocaleString("id-ID")}`;
        document.getElementById("detailPembayaranMetode").textContent =
          pembayaran.metode;
        document.getElementById("detailPembayaranStatus").textContent =
          statusText;
        document.getElementById("detailPembayaranBukti").src = pembayaran.bukti;
        document.getElementById("detailPembayaranStatus").textContent =
          statusText;
        const statusBadge = document.getElementById("pembayaranStatusBadge");
        statusBadge.className = `px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}`;
        statusBadge.textContent = statusText;

        // Update action buttons based on status
        const actionButtons = document.getElementById(
          "pembayaranActionButtons"
        );
        actionButtons.innerHTML = "";

        if (pembayaran.status === "menunggu") {
          actionButtons.innerHTML = `
                    <button type="button" onclick="confirmPembayaran('${pembayaran.id}', false)" class="px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Tolak
                    </button>
                    <button type="button" onclick="confirmPembayaran('${pembayaran.id}', true)" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Konfirmasi
                    </button>
                `;
        }

        // Show modal
        modal.classList.remove("hidden");
        modal.style.display = "block";
        feather.replace();
      }

      function hideDetailPembayaranModal() {
        const modal = document.getElementById("detailPembayaranModal");
        modal.classList.add("hidden");
        modal.style.display = "none";
      }

      // Confirm or reject pembayaran
      function confirmPembayaran(id, isConfirm) {
        Swal.fire({
          title: isConfirm ? "Konfirmasi Pembayaran?" : "Tolak Pembayaran?",
          text: isConfirm
            ? "Apakah Anda yakin ingin mengkonfirmasi pembayaran ini?"
            : "Apakah Anda yakin ingin menolak pembayaran ini?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: isConfirm ? "Ya, Konfirmasi" : "Ya, Tolak",
          cancelButtonText: "Batal",
        }).then((result) => {
          if (result.isConfirmed) {
            const pembayaranIndex = pembayaranData.findIndex(
              (p) => p.id === id
            );
            if (pembayaranIndex !== -1) {
              pembayaranData[pembayaranIndex].status = isConfirm
                ? "dikonfirmasi"
                : "ditolak";

              // Reload table
              loadPembayaranData(
                document.getElementById("filterStatus").value,
                document.getElementById("searchPembayaran").value
              );

              // Hide modal
              const modal = document.getElementById("detailPembayaranModal");
              modal.classList.add("hidden");
              modal.style.display = "none";

              // Show success message
              Swal.fire({
                icon: "success",
                title: "Berhasil!",
                text: `Pembayaran telah ${
                  isConfirm ? "dikonfirmasi" : "ditolak"
                }.`,
                confirmButtonColor: "#3b82f6",
              });
            }
          }
        });
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadPembayaranData();

        // Filter event
        document
          .getElementById("filterStatus")
          .addEventListener("change", function () {
            loadPembayaranData(
              this.value,
              document.getElementById("searchPembayaran").value
            );
          });

        // Search event
        document
          .getElementById("searchPembayaran")
          .addEventListener("input", function () {
            loadPembayaranData(
              document.getElementById("filterStatus").value,
              this.value
            );
          });
      });
    </script>
  </body>
</html>
